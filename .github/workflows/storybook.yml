name: Build and Deploy
on:
  push:
    branches: ["main"]
    # paths: ["src/**/*.@{tsx,mdx}"] # Trigger the action only when files change in the folders defined here
jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    permissions:
      pages: write
      id-token: write

    steps:
      - name: Checkout 🛎️
        uses: actions/checkout@v3

      - name: Install and Build 🔧
        run: | # Install npm packages and build the Storybook files
          npm install
          npm run build-storybook

      - name: Upload Artifact
        uses: actions/upload-artifact@v1
        with:
          name: github-pages
          path: storybook-static/

      - name: Deploy GitHub Pages site
        id: deployment
        uses: actions/deploy-pages@v1.2.4
        with:
          # GitHub token
          token: ${{ github.token }}
          # Time in milliseconds after which to timeout and cancel the deployment (default: 10 minutes)
          timeout: 600000
          # Maximum number of status report errors before cancelling a deployment (default: 10)
          error_count: 5
          # Time in milliseconds between two deployment status report (default: 5 seconds)
          reporting_interval: 5000
          # Name of the artifact to deploy
          artifact_name: github-pages
          # Is this attempting to deploy a pull request as a GitHub Pages preview site? (NOTE: This feature is only in alpha currently and is not available to the public!)
          preview: false
